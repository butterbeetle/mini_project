<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="css/detail.css" />
  </head>

  <body>
    <div class="wrapper">
      <button class="prev" type="button">
        <i class="fa-solid fa-caret-left fa-2x"></i>
      </button>
      <!--Carousel-->
      <div style="overflow: hidden">
        <div class="carousel-container">
          <!--무한히 움직일 수 있도록 마지막꺼 맨앞으로(편법임)-->
          <div class="carousel-box">
            <div class="container">
              <div class="left-left yellow">
                <img src="img/seunghoekim.png" />
              </div>
              <div class="left-right">
                <span class="profile">Profile</span>
                <div class="profile__contents">
                  <div class="profile__content">
                    <span class="item">Name 👤</span>
                    <span class="item__value">김승회</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">E-mail 📧</span>
                    <span class="item__value">butterbeetle@naver.com</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">Blog 🏷</span>
                    <span class="item__value"
                      >https://github.com/butterbeetle</span
                    >
                  </div>
                </div>
              </div>
              <div class="left-bottom">
                <div class="left-bottom-wrap">
                  <div class="aboutMe">
                    <div>About me</div>
                    <div class="aboutMe__tags">
                      <div class="aboutMe__tag">
                        <div class="tag">ISFP</div>
                        <div class="tag">특징</div>
                      </div>
                      <div class="aboutMe__tag">
                        <div class="tag">취미</div>
                        <div class="tag">관심사</div>
                      </div>
                    </div>
                  </div>
                  <div class="workTogether">
                    <span>Let's work together</span>
                    <p>
                      진짜 음식물이 그에서 반장은 오늘날이며, 당합니다. 피식
                      물품을 같이 칼날이 가라. 없은 내지 수를, 하게 정도가 삶에
                      체외가 된 강하던 있어 기쁘어요. 그 대통령은 훌륭하다
                      늘린다면 생각을 선진이 채우다. 판 부정을 딴 음대가 사노
                      한편은 건치도 있은데. 인한 생산하면서 마음으로 접던
                      현실에, 우리에서 요즈음에 너에 사찰을, 시작하다.
                    </p>
                  </div>
                </div>
              </div>
              <div class="right">
                <div class="icons">
                  <button class="icon">
                    <img src="img/yunahong.png" />
                  </button>
                  <button class="icon">
                    <img src="img/junheoklee.png" />
                  </button>
                  <button class="icon">
                    <img src="img/yelinbok_1.png" />
                  </button>
                  <button class="icon">
                    <img src="img/seunghoekim.png" />
                  </button>
                </div>
                <div class="guest__log-title">
                  <span>Say "Hello"<br />to our teammate</span>
                </div>
                <div class="guest__log">
                  <div class="comment__boxs">
                    <!--Comment 창 들어갈 곳-->
                  </div>

                  <div class="gest__log-input">
                    <div class="profile__img">
                      <img src="img/seunghoekim.png" />
                    </div>
                    <div class="user input">
                      <span class="commentName">김승회님에게 한마디</span>
                      <div class="comment">
                        <input
                          class="commentInput main main"
                          type="text"
                          placeholder="댓글을 남겨주세요."
                          max="50"
                        />
                        <button class="send main">
                          <i class="fa-regular fa-paper-plane"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--홍유나-->
          <div class="carousel-box">
            <div class="container">
              <div class="left-left green">
                <img src="img/yunahong.png" />
              </div>
              <div class="left-right">
                <span class="profile">Profile</span>
                <div class="profile__contents">
                  <div class="profile__content">
                    <span class="item">Name 👤</span>
                    <span class="item__value">홍유나</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">E-mail 📧</span>
                    <span class="item__value">ghddbsk12@naver.com</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">Blog 🏷</span>
                    <span class="item__value">https://github.com/yuna-hh</span>
                  </div>
                </div>
              </div>
              <div class="left-bottom">
                <div class="left-bottom-wrap">
                  <div class="aboutMe">
                    <div>About me</div>
                    <div class="aboutMe__tags">
                      <div class="aboutMe__tag">
                        <div class="tag">INFP</div>
                        <div class="tag">올빼미형 인간</div>
                      </div>
                      <div class="aboutMe__tag">
                        <div class="tag">노래 듣기</div>
                        <div class="tag">고양이 구경하기</div>
                      </div>
                    </div>
                  </div>
                  <div class="workTogether">
                    <span>Let's work together</span>
                    <p>
                      먼저 앞장서서 사람들을 이끌거나 아이디어를 내는 스타일은 아니지만 항상 팀원들의 의견을 존중하고 경청하고 있습니다!
                      프로젝트를 진행할 때 잘하지는 못하더라도 늘 최선을 다하려고 합니다 (〃⌒▽⌒〃)ゝ
                    </p>
                  </div>
                </div>
              </div>
              <div class="right">
                <div class="icons">
                  <button class="icon">
                    <img src="img/yunahong.png" />
                  </button>
                  <button class="icon">
                    <img src="img/junheoklee.png" />
                  </button>
                  <button class="icon">
                    <img src="img/yelinbok_1.png" />
                  </button>
                  <button class="icon">
                    <img src="img/seunghoekim.png" />
                  </button>
                </div>
                <div class="guest__log-title">
                  <span>Say "Hello"<br />to our teammate</span>
                </div>
                <div class="guest__log">
                  <div class="comment__boxs">
                    <!--Comment 창 들어갈 곳-->
                  </div>
                  <div class="gest__log-input">
                    <div class="profile__img">
                      <img src="img/yunahong.png" />
                    </div>
                    <div class="user input">
                      <span class="commentName">홍유나님에게 한마디</span>
                      <div class="comment">
                        <input
                          class="commentInput main"
                          type="text"
                          placeholder="댓글을 남겨주세요."
                          max="50"
                        />
                        <button class="send main">
                          <i class="fa-regular fa-paper-plane"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--이준혁-->
          <div class="carousel-box">
            <div class="container">
              <div class="left-left skyblue">
                <img src="img/junheoklee.png" />
              </div>
              <div class="left-right">
                <span class="profile">Profile</span>
                <div class="profile__contents">
                  <div class="profile__content">
                    <span class="item">Name 👤</span>
                    <span class="item__value">이준혁</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">E-mail 📧</span>
                    <span class="item__value">a01082440733@gmail.com</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">Blog 🏷</span>
                    <span class="item__value"
                      >https://velog.io/@ly0609/posts</span
                    >
                  </div>
                </div>
              </div>
              <div class="left-bottom">
                <div class="left-bottom-wrap">
                  <div class="aboutMe">
                    <div>About me</div>
                    <div class="aboutMe__tags">
                      <div class="aboutMe__tag">
                        <div class="tag">ISTJ</div>
                        <div class="tag">특징</div>
                      </div>
                      <div class="aboutMe__tag">
                        <div class="tag">취미</div>
                        <div class="tag">관심사</div>
                      </div>
                    </div>
                  </div>
                  <div class="workTogether">
                    <span>Let's work together</span>
                    <p>
                      진짜 음식물이 그에서 반장은 오늘날이며, 당합니다. 피식
                      물품을 같이 칼날이 가라. 없은 내지 수를, 하게 정도가 삶에
                      체외가 된 강하던 있어 기쁘어요. 그 대통령은 훌륭하다
                      늘린다면 생각을 선진이 채우다. 판 부정을 딴 음대가 사노
                      한편은 건치도 있은데. 인한 생산하면서 마음으로 접던
                      현실에, 우리에서 요즈음에 너에 사찰을, 시작하다.
                    </p>
                  </div>
                </div>
              </div>
              <div class="right">
                <div class="icons">
                  <button class="icon">
                    <img src="img/yunahong.png" />
                  </button>
                  <button class="icon">
                    <img src="img/junheoklee.png" />
                  </button>
                  <button class="icon">
                    <img src="img/yelinbok_1.png" />
                  </button>
                  <button class="icon">
                    <img src="img/seunghoekim.png" />
                  </button>
                </div>
                <div class="guest__log-title">
                  <span>Say "Hello"<br />to our teammate</span>
                </div>
                <div class="guest__log">
                  <div class="comment__boxs">
                    <!--Comment 창 들어갈 곳-->
                  </div>
                  <div class="gest__log-input">
                    <div class="profile__img">
                      <img src="img/junheoklee.png" />
                    </div>
                    <div class="user input">
                      <span class="commentName">이준혁님에게 한마디</span>
                      <div class="comment">
                        <input
                          class="commentInput main"
                          type="text"
                          placeholder="댓글을 남겨주세요."
                          max="50"
                        />
                        <button class="send main">
                          <i class="fa-regular fa-paper-plane"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--복예린-->
          <div class="carousel-box">
            <div class="container">
              <div class="left-left violet">
                <img src="img/yelinbok.png" />
              </div>
              <div class="left-right">
                <span class="profile">Profile</span>
                <div class="profile__contents">
                  <div class="profile__content">
                    <span class="item">Name 👤</span>
                    <span class="item__value">복예린</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">E-mail 📧</span>
                    <span class="item__value">yelini9060@naver.com</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">Blog 🏷</span>
                    <span class="item__value"
                      >https://velog.io/@liin/posts</span
                    >
                  </div>
                </div>
              </div>
              <div class="left-bottom">
                <div class="left-bottom-wrap">
                  <div class="aboutMe">
                    <div>About me</div>
                    <div class="aboutMe__tags">
                      <div class="aboutMe__tag">
                        <div class="tag">INTP</div>
                        <div class="tag">특징</div>
                      </div>
                      <div class="aboutMe__tag">
                        <div class="tag">취미</div>
                        <div class="tag">관심사</div>
                      </div>
                    </div>
                  </div>
                  <div class="workTogether">
                    <span>Let's work together</span>
                    <p>
                      진짜 음식물이 그에서 반장은 오늘날이며, 당합니다. 피식
                      물품을 같이 칼날이 가라. 없은 내지 수를, 하게 정도가 삶에
                      체외가 된 강하던 있어 기쁘어요. 그 대통령은 훌륭하다
                      늘린다면 생각을 선진이 채우다. 판 부정을 딴 음대가 사노
                      한편은 건치도 있은데. 인한 생산하면서 마음으로 접던
                      현실에, 우리에서 요즈음에 너에 사찰을, 시작하다.
                    </p>
                  </div>
                </div>
              </div>
              <div class="right">
                <div class="icons">
                  <button class="icon">
                    <img src="img/yunahong.png" />
                  </button>
                  <button class="icon">
                    <img src="img/junheoklee.png" />
                  </button>
                  <button class="icon">
                    <img src="img/yelinbok_1.png" />
                  </button>
                  <button class="icon">
                    <img src="img/seunghoekim.png" />
                  </button>
                </div>
                <div class="guest__log-title">
                  <span>Say "Hello"<br />to our teammate</span>
                </div>
                <div class="guest__log">
                  <div class="comment__boxs">
                    <!--Comment 창 들어갈 곳-->
                  </div>
                  <div class="gest__log-input">
                    <div class="profile__img">
                      <img src="img/yelinbok.png" />
                    </div>
                    <div class="user input">
                      <span class="commentName">복예린님에게 한마디</span>
                      <div class="comment">
                        <input
                          class="commentInput main"
                          type="text"
                          placeholder="댓글을 남겨주세요."
                          max="50"
                        />
                        <button class="send main">
                          <i class="fa-regular fa-paper-plane"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--김승회-->
          <div class="carousel-box">
            <div class="container">
              <div class="left-left yellow">
                <img src="img/seunghoekim.png" />
              </div>
              <div class="left-right">
                <span class="profile">Profile</span>
                <div class="profile__contents">
                  <div class="profile__content">
                    <span class="item">Name 👤</span>
                    <span class="item__value">김승회</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">E-mail 📧</span>
                    <span class="item__value">butterbeetle@naver.com</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">Blog 🏷</span>
                    <span class="item__value"
                      >https://github.com/butterbeetle</span
                    >
                  </div>
                </div>
              </div>
              <div class="left-bottom">
                <div class="left-bottom-wrap">
                  <div class="aboutMe">
                    <div>About me</div>
                    <div class="aboutMe__tags">
                      <div class="aboutMe__tag">
                        <div class="tag">ISFP</div>
                        <div class="tag">특징</div>
                      </div>
                      <div class="aboutMe__tag">
                        <div class="tag">취미</div>
                        <div class="tag">관심사</div>
                      </div>
                    </div>
                  </div>
                  <div class="workTogether">
                    <span>Let's work together</span>
                    <p>
                      진짜 음식물이 그에서 반장은 오늘날이며, 당합니다. 피식
                      물품을 같이 칼날이 가라. 없은 내지 수를, 하게 정도가 삶에
                      체외가 된 강하던 있어 기쁘어요. 그 대통령은 훌륭하다
                      늘린다면 생각을 선진이 채우다. 판 부정을 딴 음대가 사노
                      한편은 건치도 있은데. 인한 생산하면서 마음으로 접던
                      현실에, 우리에서 요즈음에 너에 사찰을, 시작하다.
                    </p>
                  </div>
                </div>
              </div>
              <div class="right">
                <div class="icons">
                  <button class="icon">
                    <img src="img/yunahong.png" />
                  </button>
                  <button class="icon">
                    <img src="img/junheoklee.png" />
                  </button>
                  <button class="icon">
                    <img src="img/yelinbok_1.png" />
                  </button>
                  <button class="icon">
                    <img src="img/seunghoekim.png" />
                  </button>
                </div>
                <div class="guest__log-title">
                  <span>Say "Hello"<br />to our teammate</span>
                </div>
                <div class="guest__log">
                  <div class="comment__boxs">
                    <!--Comment 창 들어갈 곳-->
                  </div>
                  <div class="gest__log-input">
                    <div class="profile__img">
                      <img src="img/seunghoekim.png" />
                    </div>
                    <div class="user input">
                      <span class="commentName">김승회님에게 한마디</span>
                      <div class="comment">
                        <input
                          class="commentInput main"
                          type="text"
                          placeholder="댓글을 남겨주세요."
                          max="50"
                        />
                        <button class="send main">
                          <i class="fa-regular fa-paper-plane"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--무한히 움직일 수 있도록 맨앞꺼 마지막으로(편법임)-->
          <div class="carousel-box">
            <div class="container">
              <div class="left-left green">
                <img src="img/yunahong.png" />
              </div>
              <div class="left-right">
                <span class="profile">Profile</span>
                <div class="profile__contents">
                  <div class="profile__content">
                    <span class="item">Name 👤</span>
                    <span class="item__value">홍유나</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">E-mail 📧</span>
                    <span class="item__value">yelini9060@naver.com</span>
                  </div>
                  <div class="profile__content">
                    <span class="item">Blog 🏷</span>
                    <span class="item__value"
                      >https://velog.io/@liin/posts</span
                    >
                  </div>
                </div>
              </div>
              <div class="left-bottom">
                <div class="left-bottom-wrap">
                  <div class="aboutMe">
                    <div>About me</div>
                    <div class="aboutMe__tags">
                      <div class="aboutMe__tag">
                        <div class="tag">INTP</div>
                        <div class="tag">특징</div>
                      </div>
                      <div class="aboutMe__tag">
                        <div class="tag">취미</div>
                        <div class="tag">관심사</div>
                      </div>
                    </div>
                  </div>
                  <div class="workTogether">
                    <span>Let's work together</span>
                    <p>
                      진짜 음식물이 그에서 반장은 오늘날이며, 당합니다. 피식
                      물품을 같이 칼날이 가라. 없은 내지 수를, 하게 정도가 삶에
                      체외가 된 강하던 있어 기쁘어요. 그 대통령은 훌륭하다
                      늘린다면 생각을 선진이 채우다. 판 부정을 딴 음대가 사노
                      한편은 건치도 있은데. 인한 생산하면서 마음으로 접던
                      현실에, 우리에서 요즈음에 너에 사찰을, 시작하다.
                    </p>
                  </div>
                </div>
              </div>
              <div class="right">
                <div class="icons">
                  <button class="icon">
                    <img src="img/yunahong.png" />
                  </button>
                  <button class="icon">
                    <img src="img/junheoklee.png" />
                  </button>
                  <button class="icon">
                    <img src="img/yelinbok_1.png" />
                  </button>
                  <button class="icon">
                    <img src="img/seunghoekim.png" />
                  </button>
                </div>
                <div class="guest__log-title">
                  <span>Say "Hello"<br />to our teammate</span>
                </div>
                <div class="guest__log">
                  <div class="comment__boxs">
                    <!--Comment 창 들어갈 곳-->
                  </div>
                  <div class="gest__log-input">
                    <div class="profile__img">
                      <img
                        src="https://images.velog.io/images/chang626/post/c9533c4f-adbb-4411-bce4-b09293d64fbf/A03EACB4-4DFA-439A-A3FE-084635A89FE6.png"
                      />
                    </div>
                    <div class="user input">
                      <span class="commentName">홍유나님에게 한마디</span>
                      <div class="comment">
                        <input
                          class="commentInput main"
                          type="text"
                          placeholder="댓글을 남겨주세요."
                          max="50"
                        />
                        <button class="send main">
                          <i class="fa-regular fa-paper-plane"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button class="next" type="button">
        <i class="fa-solid fa-caret-right fa-2x"></i>
      </button>
    </div>
    <script
      src="https://kit.fontawesome.com/748fe0d700.js"
      crossorigin="anonymous"
    ></script>
    <!--Carousel-->
    <script>
      const carousel = document.querySelector(".carousel-container");
      const carouselBox = document.querySelectorAll(".carousel-box");
      const icons = document.querySelectorAll(".icons");
      const icon = document.querySelectorAll(".icon");
      const nextBtn = document.querySelector(".next");
      const prevBtn = document.querySelector(".prev");
      const urlParams = new URL(location.href).searchParams;

      // 원하는 배경색 헥스코드로 넣기
      const myBackGroundColor = [
        "#618a58", // 홍유나
        "#8fbcdb", // 이준혁
        "#bba2fe", // 복예린
        "#e2c881", // 김승회
      ];

      let idx = 1;
      let isInteraction = false;

      const setTransition = (value) => {
        carousel.style.transition = value;
      };

      const setTranslate = () => {
        carousel.style.transform =
          "translateX(" + (-100 / carouselBox.length) * idx + "%)";
      };

      const setBackGroundColor = () => {
        const myIcon = icons[idx].getElementsByClassName("icon")[idx - 1];
        // const myBgColor = bgColors[idx].getElementsByClassName("left-left")[idx - 1];
        // myBgColor.style.backgroundColor = myBackGroundColor[idx - 1];
        myIcon.style.backgroundColor = myBackGroundColor[idx - 1];
        myIcon.style.boxShadow = "0px 0px 10px 5px rgba(0, 0, 0, 0.15)";
      };

      const interaction = () => {
        isInteraction = true;
        setTimeout(() => {
          isInteraction = false;
        }, 600);
      };

      /** 버튼 클릭 시 슬라이드 되는 스타일 변경을 담당 */
      const slide = (idx) => {
        interaction();
        setTransition("300ms all ease-in");

        setTimeout(() => {
          setTransition("");
        }, 300);

        setTranslate();
      };

      const init = () => {
        idx = urlParams.get("page");
        if (idx !== "1") {
          slide(idx);
        }
        setBackGroundColor();
        setTranslate();
      };

      init();

      icon.forEach((icon) => {
        icon.addEventListener("click", function (e) {
          let parent = e.currentTarget.parentElement;
          let children = parent.children;
          let index =
            Array.prototype.indexOf.call(children, e.currentTarget) + 1;
          if (idx !== index) {
            idx = index;
            slide(idx);
            setBackGroundColor();
          }
        });
      });

      nextBtn.addEventListener("click", () => {
        if (isInteraction) return;
        if (idx >= carouselBox.length - 1) idx = -1;
        idx++;
        slide(idx);

        if (idx === 5) {
          idx = 1;

          setTransition("300ms all ease-in");
          setTimeout(() => {
            setTransition("");
            setTranslate();
          }, 300);
        }
        setBackGroundColor();
      });

      prevBtn.addEventListener("click", () => {
        if (isInteraction) return;
        if (idx <= 0) idx = carouselBox.length;
        idx--;
        slide(idx);

        if (idx === 0) {
          idx = 4;

          setTransition("300ms all ease-in");
          setTimeout(() => {
            setTransition("");
            setTranslate();
          }, 300);
        }
        setBackGroundColor();
      });

      function change(e, flag = 0) {
        let parent = e.parentElement.previousElementSibling;
        if (flag) parent = e;
        if (parent.className === "comment") {
          let children = (parent.className += " change");
        } else {
          let children = (parent.className = "comment");
        }
      }
    </script>
    <!--FireBase-->
    <script type="module">
      // Firebase SDK 라이브러리 가져오기
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        setDoc,
        updateDoc,
        getDocs,
        doc,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
      // .env 파일에서 정보 읽어오기

      // Firebase 구성 정보 설정
      const firebaseConfig = {
        apiKey: "AIzaSyCYojszwz1ZPA8Xl0C-YM6vBEdtURa_8ls",
        authDomain: "sparta-mini-project.firebaseapp.com",
        projectId: "sparta-mini-project",
        storageBucket: "sparta-mini-project.appspot.com",
        messagingSenderId: "419621024240",
        appId: "1:419621024240:web:577e4f2a63ae76a3bdad35",
      };

      // Firebase 인스턴스 초기화
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // UserData 받아오기
      const getUser = async (db) => {
        const userCollection = collection(db, "user");
        const userSnap = await getDocs(userCollection);
        const userData = userSnap.docs.map((doc) => doc.data());
        return userData;
      };

      // send 버튼과 input창 HTML 가져오기
      const commentSendHTML = document.querySelectorAll(".send.main");
      const commentInputHTML = document.querySelectorAll(".commentInput.main");

      const MEMBER = 4;
      const userData = await getUser(db);
      /*
      0 => 김승회
      
      1 => 홍유나
      2 => 이준혁
      3 => 복예린
      4 => 김승회

      5 => 홍유나
       */

      // 개인 데이터 저장할 배열
      const personalData = new Array(MEMBER + 2);

      // userData 순회하면서 개인 데이터 저장
      userData.forEach((data, idx) => {
        personalData[data.index] = data;
      });

      // 무한 슬라이드를위해 마지막은 맨앞으로, 맨앞은 마지막으로
      personalData[0] = personalData[MEMBER];
      personalData[MEMBER + 1] = personalData[1];

      // comment 생성(HTML)
      const createChild = (message, userId, commentId) => {
        // 각 사람의 comment__boxs HTML 가져오기
        const tmpHTML = carouselBox[userId].querySelector(".comment__boxs");
        const commentHTML = `
        <div id="user_${userId}_comment_${commentId}" class="comment__box">
          <div class="profile__img">
            <img
              src="https://images.velog.io/images/chang626/post/c9533c4f-adbb-4411-bce4-b09293d64fbf/A03EACB4-4DFA-439A-A3FE-084635A89FE6.png"
            />
          </div>
          <div class="user">
            <div class="comment">
              <span>${message}</span>
              <input
                id="user_${userId}_comment_${commentId}"
                class="commentInput update"
                type="text"
                placeholder="댓글을 남겨주세요."
                max="50"
                value="${message}"
              />
              <button id="user_${userId}_comment_${commentId}" class="send update">
                <i class="fa-regular fa-paper-plane"></i>
              </button>
              </div>
              <div class="commnet-icons">
                <button class="update-btn" onClick="change(this)">
                  <img src="./img/update.png" />
                </button>
                <button id="user_${userId}_comment_${commentId}" class="delete-btn">
                  <img src="./img/delete.png" />
                </button>
              </div>
        </div>`;

        // 만든 comment_box를 위에서 가져온 guest__log에 넣기
        tmpHTML.insertAdjacentHTML("afterbegin", commentHTML);
      };
      // comment 삭제(HTML)
      const deleteChild = (userId, commentId) => {
        const tmpHTML = carouselBox[userId].querySelector(".comment__boxs");
        const target = tmpHTML.querySelector(
          `#user_${idx}_comment_${commentId}`
        );
        tmpHTML.removeChild(target);
      };

      // comment 저장(FIREBASE)
      const sendComment = async (db, userId, message) => {
        
        const length = personalData[userId].comments.length;
        let commentId = 1;
        if (length > 0)
          commentId = personalData[userId].comments[length - 1].id + 1;
        // console.log(length, commentId);
        const tmp = {
          id: commentId,
          message,
          timestamp: Date.now(),
        };

        personalData[userId].comments.push(tmp);

        await setDoc(doc(db, `user`, `${userId}`), {
          id: commentId,
          index: userId,
          comments: [...personalData[userId].comments],
        });

        createChild(message, userId, commentId);

        buttonHandler(300);
      };
      // comment 삭제(FIREBASE)
      const deleteComment = async (buttonId) => {
        const [a, userId, b, commentId] = buttonId.split("_");
        const tmp = personalData[userId].comments.filter(
          (comment) => +comment.id !== +commentId
        );
        // console.log(tmp);
        await setDoc(doc(db, `user`, `${userId}`), {
          index: userId,
          comments: [...tmp],
        });
        personalData[userId].comments = [...tmp];
        deleteChild(userId, commentId);

        buttonHandler(300);
      };
      // comment 수정(FIREBASE)
      const updateComment = async (message, userId, commentId) => {
        // console.log(
        //   `userId:${userId} commentId:${commentId} message:${message}`
        // );
        const tmp = personalData[userId].comments.map((data) => {
          if (+data.id === +commentId) {
            data.message = message;
          }
          return data;
        });

        await setDoc(doc(db, `user`, `${userId}`), {
          index: userId,
          comments: [...tmp],
        });

        personalData[userId].comments = [...tmp];
        buttonHandler(300);
      };

      // 저장한 개인 데이터를 순회
      // 페이지 클릭 시 새 페이지로 이동 하는식이 아니라 캐러셀로 되어있어서 한번에 받아오고 한번에 처리해야 되기때문
      personalData.forEach((data, userId) => {
        // 개인이 가지고 있는 코멘트 마다 comment_box 만들기
        data.comments.forEach((data) => {
          const message = data.message;
          const commentId = data.id;
          // 각 사람의 comment__boxs HTML 가져오기
          // console.log("forEach", message, userId, commentId);
          createChild(message, userId, commentId);
        });
      });

      // 읽어오는 시간 때문에 1초 후에 제대로 동작함....
      // 새로 생성 시 생성된 댓글의 수정,삭제 버튼을 감지 못하기 때문에
      // 함수를 새로 만들어 감지 할 수 있도록 함.
      const buttonHandler = (sec) => {
        setTimeout(() => {
          // 삭제용
          const deleteButtons = document.querySelectorAll(".delete-btn");
          deleteButtons.forEach((button) => {
            const buttonId = button.id;
            button.addEventListener("click", () => {
              deleteComment(buttonId);
            });
          });
          // 업뎃용
          const commentUpdateHTML = document.querySelectorAll(".send.update");
          const commentUpdateInputHTML = document.querySelectorAll(
            ".commentInput.update"
          );

          commentUpdateHTML.forEach((HTML, htmlIdx) => {
            const [a, userId, b, commentId] = HTML.id.split("_");
            HTML.addEventListener("click", () => {
              const message = commentUpdateInputHTML[htmlIdx].value;
              updateComment(message, userId, commentId);
              // HTML 변경 코드 들어갈 곳
              HTML.previousElementSibling.previousElementSibling.innerHTML =
                message;

              change(HTML.parentElement, 1);
            });
          });
        }, sec);
      };

      buttonHandler(1000);
      // 누구의 send를 눌렀는지 순회
      commentSendHTML.forEach((HTML, userId) => {
        HTML.addEventListener("click", async () => {
          // 그 사람의 input창에 입력되어있는 message 가져오기
          const message = commentInputHTML[userId].value;
          // console.log(userId, message);
          sendComment(db, userId, message);
          commentInputHTML[userId].value = "";
        });
      });
    </script>
  </body>
</html>
